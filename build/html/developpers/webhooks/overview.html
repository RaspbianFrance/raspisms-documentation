<!DOCTYPE html>
<html  lang="fr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

      <title>Les Webhooks</title>
    
      <link rel="stylesheet" href="../../_static/pygments.css">
      <link rel="stylesheet" href="../../_static/theme.css">
      <link rel="stylesheet" href="../../_static/sphinx_press_theme.css">
          <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
          <link rel="stylesheet" href="../../_static/theme.css " type="text/css" />
          <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
          <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
      
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>

      <!-- sphinx script_files -->
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
        <script src="../../_static/translations.js"></script>

      
      <script src="../../_static/theme-vendors.js"></script>
      <script src="../../_static/theme.js" defer></script>
    
  <link rel="index" title="Index" href="../../genindex.html" />
  <link rel="search" title="Recherche" href="../../search.html" />
  <link rel="next" title="Système de fichier de RaspiSMS" href="../filesystem/overview.html" />
  <link rel="prev" title="Créer un nouveau type de téléphone" href="../adapters/overview.html" /> 
  </head>

  <body>
    <div id="app" class="theme-container" :class="pageClasses"><navbar @toggle-sidebar="toggleSidebar">
  <router-link to="../../index.html" class="home-link">
    
      <img class="logo" src="../../../../_static/logo.png" alt="logo"/>
    
  </router-link>

  <div class="links">
    <navlinks class="can-hide">

  
    <div class="nav-item">
      <a href="_static/documentation_before_3_0.html"
        class="nav-link external">
          Ancienne documentation <outboundlink></outboundlink>
      </a>
    </div>
  
    <div class="nav-item">
      <a href="https://raspisms.fr"
        class="nav-link external">
          Site du projet <outboundlink></outboundlink>
      </a>
    </div>
  
    <div class="nav-item">
      <a href="https://github.com/RaspbianFrance/RaspiSMS"
        class="nav-link external">
          Github <outboundlink></outboundlink>
      </a>
    </div>
  

    </navlinks>
  </div>
</navbar>

      
      <div class="sidebar-mask" @click="toggleSidebar(false)">
      </div>
        <sidebar @toggle-sidebar="toggleSidebar">
          
          <navlinks>
            

  
    <div class="nav-item">
      <a href="_static/documentation_before_3_0.html"
        class="nav-link external">
          Ancienne documentation <outboundlink></outboundlink>
      </a>
    </div>
  
    <div class="nav-item">
      <a href="https://raspisms.fr"
        class="nav-link external">
          Site du projet <outboundlink></outboundlink>
      </a>
    </div>
  
    <div class="nav-item">
      <a href="https://github.com/RaspbianFrance/RaspiSMS"
        class="nav-link external">
          Github <outboundlink></outboundlink>
      </a>
    </div>
  

            
          </navlinks><div id="searchbox" class="searchbox" role="search">
  <div class="caption"><span class="caption-text">Recherche rapide</span>
    <div class="searchformwrapper">
      <form class="search" action="../../search.html" method="get">
        <input type="text" name="q" />
        <input type="submit" value="Recherche" />
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div><div class="sidebar-links" role="navigation" aria-label="main navigation">
    <div class="sidebar-group">
        <p class="caption" role="heading"><span class="caption-text">Quelle partie de la documentation vous intéresse ?</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../users/overview.html">Documentation pour les utilisateurs</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../overview.html">Documentation pour les développeurs</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../api/overview.html">Utiliser l’API HTTP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../adapters/overview.html">Créer un nouveau type de téléphone</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Les Webhooks</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#a-quoi-ca-sert">À quoi ça sert ?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creer-un-webhook">Créer un Webhook</a></li>
<li class="toctree-l3"><a class="reference internal" href="#contenu-de-la-requete">Contenu de la requête</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#corps-des-webhooks">Corps des webhooks</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../filesystem/overview.html">Système de fichier de RaspiSMS</a></li>
</ul>
</li>
</ul>

    </div>
</div>
        </sidebar>

      <page>
          <div class="body-header" role="navigation" aria-label="navigation">
  
  <ul class="breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
    
      <li><a href="../overview.html">Documentation pour les développeurs</a> &raquo;</li>
    
    <li>Les Webhooks</li>
  </ul>
  

  <ul class="page-nav">
  <li class="prev">
    <a href="../adapters/overview.html"
       title="Chapitre précédent">← Créer un nouveau type de téléphone</a>
  </li>
  <li class="next">
    <a href="../filesystem/overview.html"
       title="Chapitre suivant">Système de fichier de RaspiSMS →</a>
  </li>
</ul>
  
</div>
<hr>
          <div class="content" role="main" v-pre>
            
  <section id="les-webhooks">
<span id="webhooks"></span><h1>Les Webhooks<a class="headerlink" href="#les-webhooks" title="Lien permanent vers cette rubrique">¶</a></h1>
<section id="a-quoi-ca-sert">
<h2>À quoi ça sert ?<a class="headerlink" href="#a-quoi-ca-sert" title="Lien permanent vers cette rubrique">¶</a></h2>
<p>Les webhooks sont un moyen de signaler un évènement à une application tierce sans que celle-ci ait besoin d’intérroger l’application qui émet l’évènement.</p>
<p>Pour cela, lorsqu’un évènement donné se produit, l’application émetrice émet une requête HTTP vers une URL définie et appartenant à l’application réceptrice, laquelle peut alors analyser la requête reçue et adapter son comportement en conséquence.</p>
</section>
<section id="creer-un-webhook">
<h2>Créer un Webhook<a class="headerlink" href="#creer-un-webhook" title="Lien permanent vers cette rubrique">¶</a></h2>
<p>Pour créer un Webhook il vous suffit de vous rendre dans la partie « Webhooks », et de cliquer sur le bouton « Ajouter un webhook » pour accéder au formulaire de création des webhooks.</p>
<p>Vous devrez alors définir l’adresse URL à appeler lors du déclenchement du webhook. Il doit obligatoirement s’agir d’une adresse en <code class="docutils literal notranslate"><span class="pre">http://</span></code> ou <code class="docutils literal notranslate"><span class="pre">https://</span></code>. Vous devrez également choisir le type de webhook à créer, c’est-à-dire le type d’évènement qui déclenchera le webhook.</p>
</section>
<section id="contenu-de-la-requete">
<h2>Contenu de la requête<a class="headerlink" href="#contenu-de-la-requete" title="Lien permanent vers cette rubrique">¶</a></h2>
<p>Lors du déclenchement d’un webhook, la requête HTTP contient certains paramètres décrivant l’évènement survenu.</p>
<table class="docutils align-default" id="id1">
<caption><span class="caption-text">Protocole de la requête</span><a class="headerlink" href="#id1" title="Lien permanent vers ce tableau">¶</a></caption>
<tbody>
<tr class="row-odd"><td><p>Verbe HTTP</p></td>
<td><p>POST</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-default" id="id2">
<caption><span class="caption-text">Paramètres de la requête</span><a class="headerlink" href="#id2" title="Lien permanent vers ce tableau">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Nom du paramètre</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>webhook_timestamp</p></td>
<td><p>Timestamp auquel le webhook a été généré, vous pouvez vous en servir pour ignorer les webhook trop anciens</p></td>
</tr>
<tr class="row-odd"><td><p>webhook_random_id</p></td>
<td><p>Identifiant aléatoire du webhook, basé sur le timestamp et une chaine aléatoire. L’unicité de l’identifiant n’est pas garantie mais très hautement probable. Vous pouvez vous en servir sans risque pour identifier un webhook de façon unique.</p></td>
</tr>
<tr class="row-even"><td><p>webhook_signature</p></td>
<td><p>Signature du webhook. Il s’agit d’une signature <code class="docutils literal notranslate"><span class="pre">HMAC</span> <span class="pre">SHA-256</span></code> du <code class="docutils literal notranslate"><span class="pre">webhook_random_id</span></code>, signé avec votre clé API. Vous pouvez utiliser cette signature pour vérifier l’authenticité du webhook reçu.</p></td>
</tr>
<tr class="row-odd"><td><p>webhook_type</p></td>
<td><p>Type de webhook, <code class="docutils literal notranslate"><span class="pre">receive_sms</span></code> ou <code class="docutils literal notranslate"><span class="pre">send_sms</span></code>, <code class="docutils literal notranslate"><span class="pre">send_sms_status_change</span></code>, <code class="docutils literal notranslate"><span class="pre">inbound_call</span></code></p></td>
</tr>
<tr class="row-even"><td><p>body</p></td>
<td><p>Le corps du webhook, un objet JSON qui dépendra du type de webhook, voir <a class="reference internal" href="#corps-des-webhooks">Corps des webhooks</a>.</p></td>
</tr>
</tbody>
</table>
<section id="corps-des-webhooks">
<h3>Corps des webhooks<a class="headerlink" href="#corps-des-webhooks" title="Lien permanent vers cette rubrique">¶</a></h3>
<table class="docutils align-default" id="id3">
<caption><span class="caption-text">Body des webhook <code class="docutils literal notranslate"><span class="pre">receive_sms</span></code></span><a class="headerlink" href="#id3" title="Lien permanent vers ce tableau">¶</a></caption>
<tbody>
<tr class="row-odd"><td><p>id</p></td>
<td><p>Identifiant unique du SMS</p></td>
</tr>
<tr class="row-even"><td><p>at</p></td>
<td><p>Date de réception du SMS, format <code class="docutils literal notranslate"><span class="pre">Y-m-d</span> <span class="pre">h:i:s</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>origin</p></td>
<td><p>Numéro de téléphone depuis lequel le SMS a été envoyé (format international)</p></td>
</tr>
<tr class="row-even"><td><p>destination</p></td>
<td><p>ID du téléphone auquel le SMS a été envoyé</p></td>
</tr>
<tr class="row-odd"><td><p>text</p></td>
<td><p>Texte du SMS</p></td>
</tr>
<tr class="row-even"><td><p>mms</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">1</span></code> si le SMS est un MMS, <code class="docutils literal notranslate"><span class="pre">0</span></code> sinon.</p></td>
</tr>
<tr class="row-odd"><td><p>medias <code class="docutils literal notranslate"><span class="pre">optional</span></code></p></td>
<td><p>Un tableau des médias liés au message, si aucun média n’est lié, le paramètre n’existe pas.</p>
<table class="docutils align-default" id="id4">
<caption><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">Contenu</span> <span class="pre">d'un</span> <span class="pre">média</span></code></span><a class="headerlink" href="#id4" title="Lien permanent vers ce tableau">¶</a></caption>
<tbody>
<tr class="row-odd"><td><p>id</p></td>
<td><p>Id du média</p></td>
</tr>
<tr class="row-even"><td><p>id_user</p></td>
<td><p>Id de l’utilisateur auquel appartient le média</p></td>
</tr>
<tr class="row-odd"><td><p>path</p></td>
<td><p>Chemin relatif du média depuis le dossier <code class="docutils literal notranslate"><span class="pre">PWD_DATA</span></code> de RaspiSMS (par défaut <code class="docutils literal notranslate"><span class="pre">/usr/share/raspisms/data/</span></code>).</p></td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
<table class="docutils align-default" id="id5">
<caption><span class="caption-text">Body des webhook <code class="docutils literal notranslate"><span class="pre">send_sms</span></code></span><a class="headerlink" href="#id5" title="Lien permanent vers ce tableau">¶</a></caption>
<tbody>
<tr class="row-odd"><td><p>id</p></td>
<td><p>Identifiant unique du SMS</p></td>
</tr>
<tr class="row-even"><td><p>at</p></td>
<td><p>Date d’envoi du SMS, format <code class="docutils literal notranslate"><span class="pre">Y-m-d</span> <span class="pre">h:i:s</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>status</p></td>
<td><p>Statut d’envoi du SMS, <code class="docutils literal notranslate"><span class="pre">failed</span></code> si l’envoi a échoué, <code class="docutils literal notranslate"><span class="pre">unknown</span></code> sinon. En raison de la nature asynchrone du protocole SMS, on ne sait pas au moment de l’envoi si le SMS a été reçu ou non.</p>
<p>Par conséquent, dans un webhook <code class="docutils literal notranslate"><span class="pre">send_sms</span></code>, un statut <code class="docutils literal notranslate"><span class="pre">failed</span></code> indique uniquement que le serveur RaspiSMS n’a pas pu contacter le service fournisseur de SMS (API, modem, etc.), ou que celui-ci a refusé la demande d’envoi.</p>
<p>Le statut <code class="docutils literal notranslate"><span class="pre">unknown</span></code> indique uniquement que la demande d’envoi a bien été transmise et acceptée. Il ne dit <strong>rien</strong> du fait que le SMS ai, été reçu ou non par le destinataire.</p>
</td>
</tr>
<tr class="row-even"><td><p>origin</p></td>
<td><p>ID du téléphone depuis lequel le SMS a été envoyé</p></td>
</tr>
<tr class="row-odd"><td><p>destination</p></td>
<td><p>Numéro de téléphone auquel le SMS a été envoyé (format international)</p></td>
</tr>
<tr class="row-even"><td><p>text</p></td>
<td><p>Texte du SMS</p></td>
</tr>
<tr class="row-odd"><td><p>mms</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">1</span></code> si le SMS est un MMS, <code class="docutils literal notranslate"><span class="pre">0</span></code> sinon.</p></td>
</tr>
<tr class="row-even"><td><p>medias <code class="docutils literal notranslate"><span class="pre">optional</span></code></p></td>
<td><p>Un tableau des médias liés au message, si aucun média n’est lié, le paramètre n’existe pas ou contient un tableau vide.</p>
<table class="docutils align-default" id="id6">
<caption><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">Contenu</span> <span class="pre">d'un</span> <span class="pre">média</span></code></span><a class="headerlink" href="#id6" title="Lien permanent vers ce tableau">¶</a></caption>
<tbody>
<tr class="row-odd"><td><p>id</p></td>
<td><p>Id du média</p></td>
</tr>
<tr class="row-even"><td><p>id_user</p></td>
<td><p>Id de l’utilisateur auquel appartient le média</p></td>
</tr>
<tr class="row-odd"><td><p>path</p></td>
<td><p>Chemin relatif du média depuis le dossier <code class="docutils literal notranslate"><span class="pre">PWD_DATA</span></code> de RaspiSMS (par défaut <code class="docutils literal notranslate"><span class="pre">/usr/share/raspisms/data/</span></code>).</p></td>
</tr>
</tbody>
</table>
</td>
</tr>
<tr class="row-odd"><td><p>originating_scheduled</p></td>
<td><p>Identifiant unique du SMS programmé à l’origine de l’envoi. À noter qu’il est très probable que la ressource <code class="docutils literal notranslate"><span class="pre">scheduled</span></code> associée ait été détruite avant la réception du webhook.</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-default" id="id7">
<caption><span class="caption-text">Body des webhook <code class="docutils literal notranslate"><span class="pre">send_sms_status_change</span></code></span><a class="headerlink" href="#id7" title="Lien permanent vers ce tableau">¶</a></caption>
<tbody>
<tr class="row-odd"><td><p>id</p></td>
<td><p>Identifiant unique du SMS</p></td>
</tr>
<tr class="row-even"><td><p>status</p></td>
<td><p>Nouveau statut du SMS. Le statut est une chaine parmis les suivantes :</p>
<table class="docutils align-default" id="id8">
<caption><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">Types</span> <span class="pre">de</span> <span class="pre">statuts</span></code></span><a class="headerlink" href="#id8" title="Lien permanent vers ce tableau">¶</a></caption>
<tbody>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">failed</span></code></p></td>
<td><p>L’envoi du SMS a échoué. Soit RaspiSMS n’a pas pu transmettre la demande d’envoi au fournisseur télécom. Soit celui-ci à refusé l’envoi. Soit il n’a pas été possible de transmettre le message à l’utilisateur (numéro non attribué, réseau télécom indisponible, etc.).</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">success</span></code></p></td>
<td><p>Le SMS a bien été reçu par le destinataire. Cela ne signifie pas forcément que le SMS a été lu, mais au minimum qu’il a été reçu par le mobile. Pour qu’un statut <code class="docutils literal notranslate"><span class="pre">success</span></code> soit possible, il faut que le téléphone utilisé pour envoyer le SMS supporte le suivi d’envoi (voir la partie « Fonctionnalités supportées » de <a class="reference internal" href="../../users/adapters/overview.html#adapters"><span class="std std-ref">la documentation sur les types de téléphones</span></a>.).</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">unknown</span></code></p></td>
<td><p>RaspiSMS a pu transmettre la demande d’envoi, mais aucune autre information n’est disponible, le SMS peut aussi bien : Avoir été reçu sans accusé de réception ; Être en attente d’envoi ou de réception ; Avoir échoué sans suivi du statut d’envoi.</p></td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
<table class="docutils align-default" id="id9">
<caption><span class="caption-text">Body des webhook <code class="docutils literal notranslate"><span class="pre">inbound_call</span></code></span><a class="headerlink" href="#id9" title="Lien permanent vers ce tableau">¶</a></caption>
<tbody>
<tr class="row-odd"><td><p>id</p></td>
<td><p>Identifiant unique de l’appel.</p></td>
</tr>
<tr class="row-even"><td><p>id_user</p></td>
<td><p>Identifiant unique de l’utilisateur qui a passé ou reçu l’appel.</p></td>
</tr>
<tr class="row-odd"><td><p>id_phone</p></td>
<td><p>Identifiant unique du téléphone qui a passé ou reçu l’appel.</p></td>
</tr>
<tr class="row-even"><td><p>uid</p></td>
<td><p>Identifiant unique de l’appel sur la plateforme de l’opérateur. Utilisé notamment pour mettre à jour un appel lors de la réception d’un signal de fin.</p></td>
</tr>
<tr class="row-odd"><td><p>direction</p></td>
<td><p>Direction de l’appel, <code class="docutils literal notranslate"><span class="pre">inbound</span></code> si c’est un appel entrant, ou <code class="docutils literal notranslate"><span class="pre">outbound</span></code> si c’est un appel sortant.</p></td>
</tr>
<tr class="row-even"><td><p>start</p></td>
<td><p>Date de début de l’appel, au format <code class="docutils literal notranslate"><span class="pre">Y-m-d</span> <span class="pre">h:i:s</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p>end <code class="docutils literal notranslate"><span class="pre">optional</span></code></p></td>
<td><p>Date de fin de l’appel, au format <code class="docutils literal notranslate"><span class="pre">Y-m-d</span> <span class="pre">h:i:s</span></code>. Disponible uniquement si on connais la date de fin de l’appel, sinon <code class="docutils literal notranslate"><span class="pre">NULL</span></code>.</p></td>
</tr>
<tr class="row-even"><td><p>origin <code class="docutils literal notranslate"><span class="pre">optional</span></code></p></td>
<td><p>Numéro de téléphone qui a passé l’appel si c’est un appel entrant, sinon <code class="docutils literal notranslate"><span class="pre">NULL</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p>destination <code class="docutils literal notranslate"><span class="pre">optional</span></code></p></td>
<td><p>Numéro de téléphone qui a reçu l’appel si c’est un appel sortant, sinon <code class="docutils literal notranslate"><span class="pre">NULL</span></code>.</p></td>
</tr>
</tbody>
</table>
</section>
</section>
</section>


          </div>
          <div class="page-nav">
            <div class="inner"><ul class="page-nav">
  <li class="prev">
    <a href="../adapters/overview.html"
       title="Chapitre précédent">← Créer un nouveau type de téléphone</a>
  </li>
  <li class="next">
    <a href="../filesystem/overview.html"
       title="Chapitre suivant">Système de fichier de RaspiSMS →</a>
  </li>
</ul><div class="footer" role="contentinfo">
      &#169; Copyright 2021, OsaAjani.
    <br>
    Created using <a href="http://sphinx-doc.org/">Sphinx</a> 6.2.1 with <a href="https://github.com/schettino72/sphinx_press_theme">Press Theme</a> 0.9.1.
</div>
            </div>
          </div>
      </page>
    </div>
    
    
  </body>
</html>