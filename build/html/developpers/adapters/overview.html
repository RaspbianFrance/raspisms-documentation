<!DOCTYPE html>
<html  lang="fr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
      <title>Les Adaptateurs</title>
    
      <link rel="stylesheet" href="../../_static/pygments.css">
      <link rel="stylesheet" href="../../_static/theme.css">
      <link rel="stylesheet" href="../../_static/sphinx_press_theme.css">
          <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
      
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>

      <!-- sphinx script_files -->
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script src="../../_static/translations.js"></script>

      
      <script src="../../_static/theme-vendors.js"></script>
      <script src="../../_static/theme.js" defer></script>
    
  <link rel="index" title="Index" href="../../genindex.html" />
  <link rel="search" title="Recherche" href="../../search.html" />
  <link rel="prev" title="Pour les développeurs" href="../overview.html" /> 
  </head>

  <body>
    <div id="app" class="theme-container" :class="pageClasses"><navbar @toggle-sidebar="toggleSidebar">
  <router-link to="../../index.html" class="home-link">
    
      <img class="logo" src="../../_static/logo.png" alt="doit logo"/>
    
  </router-link>

  <div class="links">
    <navlinks class="can-hide">

  
    <div class="nav-item">
      <a href="https://raspisms.fr"
        class="nav-link external">
          Site du projet <outboundlink/>
      </a>
    </div>
  
    <div class="nav-item">
      <a href="https://github.com/RaspbianFrance/RaspiSMS"
        class="nav-link external">
          Github <outboundlink/>
      </a>
    </div>
  

    </navlinks>
  </div>
</navbar>

      
      <div class="sidebar-mask" @click="toggleSidebar(false)">
      </div>
        <sidebar @toggle-sidebar="toggleSidebar">
          
          <navlinks>
            

  
    <div class="nav-item">
      <a href="https://raspisms.fr"
        class="nav-link external">
          Site du projet <outboundlink/>
      </a>
    </div>
  
    <div class="nav-item">
      <a href="https://github.com/RaspbianFrance/RaspiSMS"
        class="nav-link external">
          Github <outboundlink/>
      </a>
    </div>
  

            
          </navlinks><div id="searchbox" class="searchbox" role="search">
  <div class="caption"><span class="caption-text">Recherche rapide</span>
    <div class="searchformwrapper">
      <form class="search" action="../../search.html" method="get">
        <input type="text" name="q" />
        <input type="submit" value="Recherche" />
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div><div class="sidebar-links" role="navigation" aria-label="main navigation">
    <div class="sidebar-group">
        <p class="caption"><span class="caption-text">Table des matières</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../users/overview.html">Pour les utilisateurs</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../overview.html">Pour les développeurs</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Les Adaptateurs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#objectif-des-adapateurs">Objectif des adapateurs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#les-methodes-de-la-classe-adapterinterface-et-leurs-roles">Les méthodes de la classe <code class="docutils literal notranslate"><span class="pre">AdapterInterface</span></code> et leurs rôles</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#les-methodes-meta">Les méthodes <code class="docutils literal notranslate"><span class="pre">meta_*</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#le-constructeur-de-l-adaptateur">Le constructeur de l’adaptateur</a></li>
<li class="toctree-l4"><a class="reference internal" href="#validation-des-donnees-de-configuration">Validation des données de configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#les-methodes-d-envoi-et-de-lecture">Les méthodes d’envoi et de lecture</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#envoi-d-un-sms">Envoi d’un SMS</a></li>
<li class="toctree-l5"><a class="reference internal" href="#lecture-d-un-sms">Lecture d’un SMS</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#les-methodes-de-callback">Les méthodes de callback</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#mise-a-jour-du-status-d-un-sms">Mise à jour du status d’un SMS</a></li>
<li class="toctree-l5"><a class="reference internal" href="#reception-d-un-sms">Réception d’un SMS</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

    </div>
</div>
        </sidebar>

      <page>
          <div class="body-header" role="navigation" aria-label="navigation">
  
  <ul class="breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
    
      <li><a href="../overview.html">Pour les développeurs</a> &raquo;</li>
    
    <li>Les Adaptateurs</li>
  </ul>
  

  <ul class="page-nav">
  <li class="prev">
    <a href="../overview.html"
       title="Chapitre précédent">← Pour les développeurs</a>
  </li>
</ul>
  
</div>
<hr>
          <div class="content" role="main">
            
  <div class="section" id="les-adaptateurs">
<h1>Les Adaptateurs<a class="headerlink" href="#les-adaptateurs" title="Lien permanent vers ce titre">¶</a></h1>
<div class="section" id="objectif-des-adapateurs">
<h2>Objectif des adapateurs<a class="headerlink" href="#objectif-des-adapateurs" title="Lien permanent vers ce titre">¶</a></h2>
<p>Les adaptateurs ont pour objectif de permettre la prise en charge simple de nombreux fournisseurs de SMS.
Pour cela, les adaptateurs offrent une interface standardisée entre le code de RaspiSMS et le code des fournisseurs, lequel change d’un fournisseur à un autre.</p>
<p>Grâce à cette organisation il est facile d’ajouter le support de nouveaux fournisseurs de SMS, puisqu’il suffit de créer un nouvel adaptateur et qu’il n’est pas nécessaire de toucher aux autres parties de RaspiSMS.</p>
<p>Si vous souhaitez ajouter un nouvel adaptateur vous devez donc implémenter l’interface <code class="docutils literal notranslate"><span class="pre">adapters/AdapterInterface</span></code>, laquelle impose un certain nombre de méthodes que nous allons voir ci-dessous.</p>
</div>
<div class="section" id="les-methodes-de-la-classe-adapterinterface-et-leurs-roles">
<h2>Les méthodes de la classe <code class="docutils literal notranslate"><span class="pre">AdapterInterface</span></code> et leurs rôles<a class="headerlink" href="#les-methodes-de-la-classe-adapterinterface-et-leurs-roles" title="Lien permanent vers ce titre">¶</a></h2>
<div class="section" id="les-methodes-meta">
<h3>Les méthodes <code class="docutils literal notranslate"><span class="pre">meta_*</span></code><a class="headerlink" href="#les-methodes-meta" title="Lien permanent vers ce titre">¶</a></h3>
<p>Les méthodes commençant par <code class="docutils literal notranslate"><span class="pre">meta_</span></code> permettent de définir les capacités et les informations relatives à l’adaptateur, tel que son nom, les champs supplémentaires permettant la configuration de l’adaptateur, ou encore les fonctionnalités disponibles.</p>
<p>Pour cela ces fonctions doivent retourner des chaines de caractères ou des tableaux. Ces méthodes doivent être envisagées comme de simple propriétés et à ce titre sont toutes statiques. L’objectif est de forcer l’implémentation des méthodes par les classes implémentant l’interface, car PHP ne supporte pas les propriétés abstraites.</p>
<dl>
<dt>meta_classname</dt><dd><p>Nom de la classe de l’adaptateur, il devrait uniquement retourner <code class="docutils literal notranslate"><span class="pre">__CLASS__</span></code>.</p>
</dd>
<dt>meta_uid</dt><dd><p>Le nom unique de l’adaptateur, en <strong>snake_case</strong>. Par exemple, si l’adaptateur s’appel <strong>« GammuAdapter »</strong>, un bon <code class="docutils literal notranslate"><span class="pre">meta_uid</span></code> est <strong>« gammu_adapter »</strong>.</p>
</dd>
<dt>meta_name</dt><dd><p>Le nom de l’adaptateur tel qu’il sera affiché à l’utilisateur. Par exemple, si vous créez un adaptateur pour un service externe example-sms.com, vous pourriez utiliser « Example SMS ».</p>
</dd>
<dt>meta_description</dt><dd><p>La description de l’adaptateur et du service qu’il permet d’utiliser. Cette description sera affichée à l’utilisateur.</p>
</dd>
<dt>meta_datas_fields</dt><dd><p>Les champs à afficher lors de la création du téléphone et permettant de configurer l’adaptateur, par exemple renseigner les clefs API du service implémenté.</p>
<p>La fonction retourne un tableau où chaque ligne correspond à un <code class="docutils literal notranslate"><span class="pre">input</span></code> qui devra être affiché sur la page de création du téléphone.</p>
<p>Chaque ligne est donc elle même un tableau avec les clefs suivantes :</p>
<ul class="simple">
<li><p><strong>name</strong> (<em>str</em>) – La clé qui sera utilisé pour accéder à la propriété. Il doit s’agir d’un nom valide pouvant servir de clé à un tableau PHP. Le nom sera aussi utilisé comme nom de l’input HTML.</p></li>
<li><p><strong>title</strong> (<em>str</em>) –  Le titre qui sera affiché au dessus de l’input.</p></li>
<li><p><strong>description</strong> (<em>str</em>) – La description qui sera affichée à l’utilisateur avant l’input. Cette description devrait permettre à l’utilisateur de comprendre l’utilité du réglage.</p></li>
<li><p><strong>required</strong> (<em>bool</em>) – Défini si le champs est obligatoire. Si <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> l’utilisateur devra obligatoirement remplir le champs pour pouvoir créer un téléphone avec cet adaptateur.</p></li>
<li><p><strong>number</strong> (<em>bool</em>), <code class="docutils literal notranslate"><span class="pre">false</span></code> – Défini si le champs est un numéro de téléphone nécessitant l’utilisation d’un input dédié avec internationalisation des numéros.</p></li>
</ul>
</dd>
<dt>meta_support_read</dt><dd><p>Booléen définissant si l’adaptateur supporte la lecture directe des SMS reçus, par exemple via un appel à une API, par opposition à la lecture des SMS par appel d’une callback HTTP. Si <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> alors <code class="docutils literal notranslate"><span class="pre">meta_support_reception</span></code> doit obligatoirement être à <code class="docutils literal notranslate"><span class="pre">FALSE</span></code>.</p>
<p>À vous de choisir selon les capacités du service implémenté la solution la plus adaptée entre callback HTTP et lecture directe, les deux ayant leurs avantages et leurs inconvénients.</p>
</dd>
<dt>meta_support_reception</dt><dd><p>Booléen définissant si l’adaptateur supporte la réception de SMS par appel à une callback HTTP. Si <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> alors <code class="docutils literal notranslate"><span class="pre">meta_support_read</span></code> doit être à <code class="docutils literal notranslate"><span class="pre">FALSE</span></code>.</p>
</dd>
<dt>meta_support_status_change</dt><dd><p>Booléen définissant si l’adaptateur supporte la mise à jour du status d’un SMS par l’appel à une callback HTTP.</p>
</dd>
<dt>meta_support_flash</dt><dd><p>Booléen définissant si l’adaptateur supporte les SMS flash.</p>
</dd>
</dl>
</div>
<div class="section" id="le-constructeur-de-l-adaptateur">
<h3>Le constructeur de l’adaptateur<a class="headerlink" href="#le-constructeur-de-l-adaptateur" title="Lien permanent vers ce titre">¶</a></h3>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">public function __construct(stringdatas)</span>
</pre></div>
</div>
<p>La fonctions prend en argument une chaine de caractère <code class="docutils literal notranslate"><span class="pre">$datas</span></code> qui est une chaîne JSON contenant les données de configuration de l’adaptateur. Il s’agit des données indiqués via les champs générés en utilisant <code class="docutils literal notranslate"><span class="pre">meta_datas_fields</span></code>.</p>
<p>À vous de décoder ces données et de les utiliser pour générer un client API, un fichier de configuration ou autre.</p>
</div>
<div class="section" id="validation-des-donnees-de-configuration">
<h3>Validation des données de configuration<a class="headerlink" href="#validation-des-donnees-de-configuration" title="Lien permanent vers ce titre">¶</a></h3>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">public function test (): bool</span>
</pre></div>
</div>
<p>Au moment ou un utilisateur valide la création d’un téléphone utilisant l’adaptateur, la classe est instanciée et la méthode <code class="docutils literal notranslate"><span class="pre">test()</span></code> est appelée.</p>
<p>La méthode devrait alors vérifier que les données de configuration transmises sont valides, par exemple vérifier que les identifiants API fournis permettent bien se connecter à l’API.</p>
<p>La méthode doit retournée <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> en cas de succès et <code class="docutils literal notranslate"><span class="pre">FALSE</span></code> en cas d’échec, auquel cas l’utilisateur se verra indiqué que la configuration fournie n’est pas valide.</p>
</div>
<div class="section" id="les-methodes-d-envoi-et-de-lecture">
<h3>Les méthodes d’envoi et de lecture<a class="headerlink" href="#les-methodes-d-envoi-et-de-lecture" title="Lien permanent vers ce titre">¶</a></h3>
<p>Ces méthodes permettent l’envoi de SMS et la lecture des SMS reçus.</p>
<div class="section" id="envoi-d-un-sms">
<h4>Envoi d’un SMS<a class="headerlink" href="#envoi-d-un-sms" title="Lien permanent vers ce titre">¶</a></h4>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">public function send (stringdestination, stringtext, boolflash = false)</span>
</pre></div>
</div>
<dl class="simple">
<dt>La méthode est appelée à chaque SMS envoyé via l’adaptateur et prend trois arguments, détaillés ci-après :</dt><dd><ul class="simple">
<li><p><strong>$destination</strong> (<em>str</em>) – Le numéro auquel envoyer le SMS.</p></li>
<li><p><strong>$text</strong> (<em>str</em>) – Le corps du SMS à envoyer.</p></li>
<li><p><strong>$flash</strong> (<em>str</em>), <code class="docutils literal notranslate"><span class="pre">FALSE</span></code> – Défini si le SMS envoyé doit être un SMS flash.</p></li>
</ul>
</dd>
<dt>La fonction doit retourner un tableau avec trois clés :</dt><dd><ul class="simple">
<li><p><strong>error</strong> (<em>bool</em>) – <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> si une erreure est survenue et <code class="docutils literal notranslate"><span class="pre">FALSE</span></code> sinon.</p></li>
<li><p><strong>error_message</strong> (<em>str | null</em>) – Le message d’erreur en cas d’echec, ou <code class="docutils literal notranslate"><span class="pre">NULL</span></code> en cas de succés.</p></li>
<li><p><strong>uid</strong> (<em>str | null</em>) – L’identifiant unique du SMS envoyé au sein de la plateforme implémentée par l’adaptateur. Cet identifiant doit permettre de retrouver le SMS sur la plateforme, par exemple lors de la réception d’un appel HTTP de callback indiquant la mise à jour du status d’un SMS. Si une erreure est survenue <code class="docutils literal notranslate"><span class="pre">uid</span></code> doit être à <code class="docutils literal notranslate"><span class="pre">NULL</span></code>.</p></li>
</ul>
</dd>
</dl>
</div>
<div class="section" id="lecture-d-un-sms">
<h4>Lecture d’un SMS<a class="headerlink" href="#lecture-d-un-sms" title="Lien permanent vers ce titre">¶</a></h4>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">public function read (): array</span>
</pre></div>
</div>
<p>La méthode appelée pour lire les SMS reçus. Cette méthode est appelée <strong>très</strong> souvent (environ 2 fois par seconde), à vous de vous assurez que cela n’entrainera pas de dépassement des capacité du service implémenté, et potentiellement de mettre en place des mécanisme de temporisation.</p>
<dl class="simple">
<dt>La fonction retourne un tableau tel que suit :</dt><dd><ul class="simple">
<li><p><strong>error</strong> (<em>bool</em>), <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> – <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> si une erreure est survenue et <code class="docutils literal notranslate"><span class="pre">FALSE</span></code> sinon.</p></li>
<li><p><strong>error_message</strong> (<em>str | null</em>) – Le message d’erreur en cas d’echec, ou <code class="docutils literal notranslate"><span class="pre">NULL</span></code> en cas de succés.</p></li>
<li><p><strong>smss</strong> (<em>array</em>) – Un tableau avec les SMS reçus, ou un tableau vide en cas d’erreur. Chaque ligne est un SMS représenté lui même par un tableau avec les clés suivantes :</p>
<ul>
<li><p><strong>at</strong> (<em>str</em>) – La date de réception du SMS au format <code class="docutils literal notranslate"><span class="pre">Y-m-d</span> <span class="pre">H:i:s</span></code>.</p></li>
<li><p><strong>text</strong> (<em>str</em>) – Le corps du SMS.</p></li>
<li><p><strong>origin</strong> (<em>str</em>) – Le numéro de l’émetteur du SMS, au format international (ex : +33612345678).</p></li>
</ul>
</li>
</ul>
</dd>
</dl>
</div>
</div>
<div class="section" id="les-methodes-de-callback">
<h3>Les méthodes de callback<a class="headerlink" href="#les-methodes-de-callback" title="Lien permanent vers ce titre">¶</a></h3>
<p>Ces méthodes sont appelées par RaspiSMS lors de la réception d’une requête HTTP de callback concernant cet adaptateur.</p>
<div class="section" id="mise-a-jour-du-status-d-un-sms">
<h4>Mise à jour du status d’un SMS<a class="headerlink" href="#mise-a-jour-du-status-d-un-sms" title="Lien permanent vers ce titre">¶</a></h4>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">public static function status_change_callback()</span>
</pre></div>
</div>
<p>La méthode est appelée lors de la réception d’un appel HTTP indiquant la mise à jour du status d’un SMS.</p>
<dl class="simple">
<dt>La méthode doit retournée <code class="docutils literal notranslate"><span class="pre">FALSE</span></code> si une erreure survient, ou un tableau en cas de succès avec:</dt><dd><ul class="simple">
<li><p><strong>uid</strong> (<em>str</em>) – L’identifiant unique du SMS au sein de la plateforme implémentée.</p></li>
<li><p><strong>status</strong> (<em>str</em>) – Le nouveau status du SMS, soit <code class="docutils literal notranslate"><span class="pre">\models\Sended::STATUS_UNKNOWN</span></code> pour un status inconnu, <code class="docutils literal notranslate"><span class="pre">\models\Sended::STATUS_DELIVERED</span></code> pour un SMS reçus par le destinataire, ou <code class="docutils literal notranslate"><span class="pre">\models\Sended::STATUS_FAILED</span></code> si l’envoi du SMS à échoué.</p></li>
</ul>
</dd>
</dl>
</div>
<div class="section" id="reception-d-un-sms">
<h4>Réception d’un SMS<a class="headerlink" href="#reception-d-un-sms" title="Lien permanent vers ce titre">¶</a></h4>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">public static function reception_callback() : array</span>
</pre></div>
</div>
<p>La méthode est appelée lors e la réception d’un appel HTTP indiquant la réception d’un SMS.</p>
<dl class="simple">
<dt>La méthode doit transformé les données transmises par la plateforme implémentée en un SMS dans un format adapté à RaspiSMS. Pour cela elle doit retourner un tableau avec :</dt><dd><ul class="simple">
<li><p><strong>error</strong> (<em>bool</em>) – <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> en cas d’erreur, sinon <code class="docutils literal notranslate"><span class="pre">FALSE</span></code>.</p></li>
<li><p><strong>error_message</strong> (<em>str | null</em>) – Un message d’erreur en cas d’erreur, sinon <code class="docutils literal notranslate"><span class="pre">NULL</span></code>.</p></li>
<li><p><strong>sms</strong> (<em>array</em>) – Un tableau représentant le SMS reçu, ou un tableau vide en cas d’erreur</p>
<ul>
<li><p><strong>at</strong> (<em>str</em>) – Date de réception du SMS au format <code class="docutils literal notranslate"><span class="pre">Y-m-d</span> <span class="pre">H:i:s</span></code></p></li>
<li><p><strong>text</strong> (<em>str</em>) – Le corps du SMS</p></li>
<li><p><strong>origin</strong> (<em>str</em>) – Le numéro de l’expéditeur au format international</p></li>
</ul>
</li>
</ul>
</dd>
</dl>
</div>
</div>
</div>
</div>


          </div>
          <div class="page-nav">
            <div class="inner"><ul class="page-nav">
  <li class="prev">
    <a href="../overview.html"
       title="Chapitre précédent">← Pour les développeurs</a>
  </li>
</ul><div class="footer" role="contentinfo">
      &#169; Copyright 2020, OsaAjani.
    <br>
    Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.0.0 with <a href="https://github.com/schettino72/sphinx_press_theme">Press Theme</a>.
</div>
            </div>
          </div>
      </page>
    </div>
    
    
  </body>
</html>